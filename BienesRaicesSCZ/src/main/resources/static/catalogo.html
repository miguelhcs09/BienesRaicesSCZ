<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Catálogo - Bienes Raíces SCZ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; margin: 0; background-color: #FFFFFF; color: #333; }
        .header { display: flex; justify-content: space-between; align-items: center; padding: 1em 2em; background-color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 100;}
        .logo img { height: 50px; width: auto; vertical-align: middle; }
        .nav a { margin-left: 1.5em; text-decoration: none; color: #555; font-weight: 500; }
        .main-content { padding: 2em; }
        h1 { text-align: center; margin-bottom: 1.5em; }
        .filtros { text-align: center; margin-bottom: 2em; }
        .filtros button { padding: 10px 20px; margin: 0 5px; border: 1px solid #ccc; background-color: white; border-radius: 20px; cursor: pointer; font-size: 1em; font-family: 'Poppins', sans-serif; }
        .filtros button.active { background-color: #014D4E; color: white; border-color: #014D4E; }
        .catalogo { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5em; }
        .casa-card { background-color: white; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); overflow: hidden; text-decoration: none; color: #333; transition: transform 0.2s ease; }
        .casa-card:hover { transform: translateY(-5px); }
        .casa-card img { width: 100%; height: 200px; object-fit: cover; }
        .casa-info { padding: 1.5em; }
        .casa-tipo { display: inline-block; padding: 5px 10px; border-radius: 15px; font-size: 0.8em; font-weight: 700; color: white; margin-bottom: 1em; text-transform: capitalize; }
        .tipo-VENTA { background-color: #28a745; }
        .tipo-ALQUILER { background-color: #007bff; }
        .tipo-ANTICRETICO { background-color: #dc3545; }
        .casa-info h3 { margin: 0 0 0.5em 0; }
        .casa-precio { font-size: 1.5em; font-weight: 700; color: #014D4E; }
    </style>
    <script> if (!sessionStorage.getItem('usuario')) { window.location.href = '/login.html'; } </script>
</head>
<body>
<header class="header">
    <div class="logo"><img src="/images/logo.png" alt="Logo de Bienes Raíces SCZ"></div>
    <nav class="nav"><a href="/index.html">Inicio</a><a href="/catalogo.html">Catálogo</a><a href="/agentes.html">Nuestros Agentes</a><a href="/index.html#contacto">Contacto</a></nav>
</header>
<main class="main-content">
    <h1>Nuestro Catálogo de Propiedades</h1>
    <div class="filtros">
        <button class="active" onclick="filtrar('TODOS', this)">Todos</button>
        <button onclick="filtrar('VENTA', this)">Venta</button>
        <button onclick="filtrar('ALQUILER', this)">Alquiler</button>
        <button onclick="filtrar('ANTICRETICO', this)">Anticrético</button>
    </div>
    <div id="catalogo-container" class="catalogo"></div>
</main>
<script>
    const catalogoContainer = document.getElementById('catalogo-container');
    const apiUrl = '/api/catalogo/casas';
    let todasLasCasas = [];
    async function cargarCasas() {
        catalogoContainer.innerHTML = '<p>Cargando propiedades...</p>';
        try {
            const response = await fetch(apiUrl);
            if (!response.ok) throw new Error('Error al cargar los datos del servidor.');
            todasLasCasas = await response.json();
            renderizarCasas(todasLasCasas);
        } catch (error) { catalogoContainer.innerHTML = `<p style="color:red;">${error.message}</p>`; }
    }
    function renderizarCasas(casas) {
        catalogoContainer.innerHTML = '';
        if (casas.length === 0) { catalogoContainer.innerHTML = '<p>No hay propiedades que coincidan con el filtro.</p>'; }
        else {
            casas.forEach(casa => {
                const casaElement = document.createElement('a');
                casaElement.className = 'casa-card';
                casaElement.href = `/detalle.html?id=${casa.id}`;
                const precioFormateado = casa.tipo === 'ALQUILER' ? `$${casa.precio.toLocaleString()}/mes` : `$${casa.precio.toLocaleString()}`;
                const tipoTexto = casa.tipo.toLowerCase().replace('_', ' ');
                casaElement.innerHTML = `<img src="${casa.imagenUrl}" alt="Foto de ${casa.titulo}"><div class="casa-info"><span class="casa-tipo tipo-${casa.tipo}">${tipoTexto}</span><h3>${casa.titulo}</h3><p>${casa.direccion}</p><p class="casa-precio">${precioFormateado}</p></div>`;
                catalogoContainer.appendChild(casaElement);
            });
        }
    }
    function filtrar(tipo, botonSeleccionado) {
        document.querySelectorAll('.filtros button').forEach(btn => btn.classList.remove('active'));
        botonSeleccionado.classList.add('active');
        if (tipo === 'TODOS') { renderizarCasas(todasLasCasas); }
        else { const casasFiltradas = todasLasCasas.filter(c => c.tipo === tipo); renderizarCasas(casasFiltradas); }
    }
    document.addEventListener('DOMContentLoaded', cargarCasas);
</script>
</body>
</html>